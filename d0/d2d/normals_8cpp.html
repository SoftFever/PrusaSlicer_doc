<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Prusa Slicer: src/admesh/normals.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../PrusaSlicer_32px.png"/></td>
  <td id="projectalign">
   <div id="projectname">Prusa Slicer<span id="projectnumber">&#160;2.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/d2d/normals_8cpp.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">normals.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;boost/pool/object_pool.hpp&gt;</code><br />
<code>#include &quot;<a class="el" href="../../">stl.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Include dependency graph for normals.cpp:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d2/d90/normals_8cpp__incl.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5a1428af7fc6f059715ed640b1fa352d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a5a1428af7fc6f059715ed640b1fa352d">BOOST_POOL_NO_MT</a></td></tr>
<tr class="separator:a5a1428af7fc6f059715ed640b1fa352d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4ec93308f972e070841765c843a07295"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a> (<a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *stl, int facet_num)</td></tr>
<tr class="separator:a4ec93308f972e070841765c843a07295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52040f23a68528dd25ecb65d5459dd98"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a52040f23a68528dd25ecb65d5459dd98">check_normal_vector</a> (<a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *stl, int facet_num, int normal_fix_flag)</td></tr>
<tr class="separator:a52040f23a68528dd25ecb65d5459dd98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a440ad3441e64d847b1749ec2d469ae68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a440ad3441e64d847b1749ec2d469ae68">stl_fix_normal_directions</a> (<a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *stl)</td></tr>
<tr class="separator:a440ad3441e64d847b1749ec2d469ae68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23672d4232108aea47cb3559d3d26620"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a23672d4232108aea47cb3559d3d26620">stl_fix_normal_values</a> (<a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *stl)</td></tr>
<tr class="separator:a23672d4232108aea47cb3559d3d26620"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aede818a0eba00cc97d4401a2e69eb9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d2d/normals_8cpp.html#a2aede818a0eba00cc97d4401a2e69eb9">stl_reverse_all_facets</a> (<a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *stl)</td></tr>
<tr class="separator:a2aede818a0eba00cc97d4401a2e69eb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a5a1428af7fc6f059715ed640b1fa352d" name="a5a1428af7fc6f059715ed640b1fa352d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a1428af7fc6f059715ed640b1fa352d">&#9670;&#160;</a></span>BOOST_POOL_NO_MT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BOOST_POOL_NO_MT</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a52040f23a68528dd25ecb65d5459dd98" name="a52040f23a68528dd25ecb65d5459dd98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52040f23a68528dd25ecb65d5459dd98">&#9670;&#160;</a></span>check_normal_vector()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_normal_vector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *&#160;</td>
          <td class="paramname"><em>stl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>facet_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>normal_fix_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   70</span>{</div>
<div class="line"><span class="lineno">   71</span>  <a class="code hl_struct" href="../../d8/d75/structstl__facet.html">stl_facet</a> *facet = &amp;stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[facet_num];</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>  <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">   74</span>  <a class="code hl_function" href="../../d5/d51/stl_8h.html#a54a7a9b89aeb6bd37c758e2e84d2e19c">stl_calculate_normal</a>(normal, facet);</div>
<div class="line"><span class="lineno">   75</span>  <a class="code hl_function" href="../../d5/d51/stl_8h.html#afd576ac265350e491aac90c15f7ebcf5">stl_normalize_vector</a>(normal);</div>
<div class="line"><span class="lineno">   76</span>  <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> normal_dif = (<a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a> - facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a>).<a class="code hl_function" href="../../d0/d5f/_matrix_cwise_unary_ops_8h.html#afaccb60c8e7e930b441a048374b64ea3">cwiseAbs</a>();</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> eps = 0.001f;</div>
<div class="line"><span class="lineno">   79</span>  <span class="keywordflow">if</span> (normal_dif(0) &lt; eps &amp;&amp; normal_dif(1) &lt; eps &amp;&amp; normal_dif(2) &lt; eps) {</div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// Normal is within tolerance. It is not really necessary to change the values here, but just for consistency, I will.</span></div>
<div class="line"><span class="lineno">   81</span>    facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a> = <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   83</span>  }</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span>  <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> test_norm = facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a>;</div>
<div class="line"><span class="lineno">   86</span>  <a class="code hl_function" href="../../d5/d51/stl_8h.html#afd576ac265350e491aac90c15f7ebcf5">stl_normalize_vector</a>(test_norm);</div>
<div class="line"><span class="lineno">   87</span>  normal_dif = (<a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a> - test_norm).<a class="code hl_function" href="../../d0/d5f/_matrix_cwise_unary_ops_8h.html#afaccb60c8e7e930b441a048374b64ea3">cwiseAbs</a>();</div>
<div class="line"><span class="lineno">   88</span>  <span class="keywordflow">if</span> (normal_dif(0) &lt; eps &amp;&amp; normal_dif(1) &lt; eps &amp;&amp; normal_dif(2) &lt; eps) {</div>
<div class="line"><span class="lineno">   89</span>    <span class="comment">// The normal is not within tolerance, but direction is OK.</span></div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">if</span> (normal_fix_flag) {</div>
<div class="line"><span class="lineno">   91</span>        facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a> = <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">   92</span>        ++ stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#abae663ef93b667599c361d67a77fb09a">normals_fixed</a>;</div>
<div class="line"><span class="lineno">   93</span>    }</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   95</span>  }</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>  test_norm *= -1.f;</div>
<div class="line"><span class="lineno">   98</span>  normal_dif = (<a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a> - test_norm).<a class="code hl_function" href="../../d0/d5f/_matrix_cwise_unary_ops_8h.html#afaccb60c8e7e930b441a048374b64ea3">cwiseAbs</a>();</div>
<div class="line"><span class="lineno">   99</span>  <span class="keywordflow">if</span> (normal_dif(0) &lt; eps &amp;&amp; normal_dif(1) &lt; eps &amp;&amp; normal_dif(2) &lt; eps) {</div>
<div class="line"><span class="lineno">  100</span>    <span class="comment">// The normal is not within tolerance and backwards.</span></div>
<div class="line"><span class="lineno">  101</span>    <span class="keywordflow">if</span> (normal_fix_flag) {</div>
<div class="line"><span class="lineno">  102</span>        facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a> = <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">  103</span>        ++ stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#abae663ef93b667599c361d67a77fb09a">normals_fixed</a>;</div>
<div class="line"><span class="lineno">  104</span>    }</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  106</span>  }</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">if</span> (normal_fix_flag) {</div>
<div class="line"><span class="lineno">  108</span>    facet-&gt;<a class="code hl_variable" href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">normal</a> = <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">  109</span>    ++ stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#abae663ef93b667599c361d67a77fb09a">normals_fixed</a>;</div>
<div class="line"><span class="lineno">  110</span>  }</div>
<div class="line"><span class="lineno">  111</span>  <span class="comment">// Status is unknown.</span></div>
<div class="line"><span class="lineno">  112</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  113</span>}</div>
<div class="ttc" id="a_matrix_cwise_unary_ops_8h_html_afaccb60c8e7e930b441a048374b64ea3"><div class="ttname"><a href="../../d0/d5f/_matrix_cwise_unary_ops_8h.html#afaccb60c8e7e930b441a048374b64ea3">cwiseAbs</a></div><div class="ttdeci">EIGEN_DEVICE_FUNC EIGEN_STRONG_INLINE const CwiseAbsReturnType cwiseAbs() const</div><div class="ttdef"><b>Definition</b> MatrixCwiseUnaryOps.h:32</div></div>
<div class="ttc" id="aclass_eigen_1_1_matrix_html"><div class="ttname"><a href="../../d2/d2d/class_eigen_1_1_matrix.html">Eigen::Matrix&lt; float, 3, 1, Eigen::DontAlign &gt;</a></div></div>
<div class="ttc" id="anamespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03_html_a9702d7dc6b0a37966d1157909ff81294"><div class="ttname"><a href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">Slic3r::sla::anonymous_namespace{Rotfinder.cpp}::normal</a></div><div class="ttdeci">Vec&lt; 3, T &gt; normal(const std::array&lt; Vec&lt; 3, T &gt;, 3 &gt; &amp;tri)</div><div class="ttdef"><b>Definition</b> Rotfinder.cpp:43</div></div>
<div class="ttc" id="astl_8h_html_a54a7a9b89aeb6bd37c758e2e84d2e19c"><div class="ttname"><a href="../../d5/d51/stl_8h.html#a54a7a9b89aeb6bd37c758e2e84d2e19c">stl_calculate_normal</a></div><div class="ttdeci">void stl_calculate_normal(stl_normal &amp;normal, stl_facet *facet)</div><div class="ttdef"><b>Definition</b> stl.h:318</div></div>
<div class="ttc" id="astl_8h_html_afd576ac265350e491aac90c15f7ebcf5"><div class="ttname"><a href="../../d5/d51/stl_8h.html#afd576ac265350e491aac90c15f7ebcf5">stl_normalize_vector</a></div><div class="ttdeci">void stl_normalize_vector(stl_normal &amp;normal)</div><div class="ttdef"><b>Definition</b> stl.h:321</div></div>
<div class="ttc" id="astructstl__facet_html"><div class="ttname"><a href="../../d8/d75/structstl__facet.html">stl_facet</a></div><div class="ttdef"><b>Definition</b> stl.h:48</div></div>
<div class="ttc" id="astructstl__facet_html_aa8ddb52e8c334b482274bc8e32d8bb06"><div class="ttname"><a href="../../d8/d75/structstl__facet.html#aa8ddb52e8c334b482274bc8e32d8bb06">stl_facet::normal</a></div><div class="ttdeci">stl_normal normal</div><div class="ttdef"><b>Definition</b> stl.h:49</div></div>
<div class="ttc" id="astructstl__file_html_a12be2d9b48bb536d8692fae451f59125"><div class="ttname"><a href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">stl_file::facet_start</a></div><div class="ttdeci">std::vector&lt; stl_facet &gt; facet_start</div><div class="ttdef"><b>Definition</b> stl.h:150</div></div>
<div class="ttc" id="astructstl__file_html_a2488861d11a4e223d2208c5eb0fd1341"><div class="ttname"><a href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stl_file::stats</a></div><div class="ttdeci">stl_stats stats</div><div class="ttdef"><b>Definition</b> stl.h:153</div></div>
<div class="ttc" id="astructstl__stats_html_abae663ef93b667599c361d67a77fb09a"><div class="ttname"><a href="../../d2/d7f/structstl__stats.html#abae663ef93b667599c361d67a77fb09a">stl_stats::normals_fixed</a></div><div class="ttdeci">int normals_fixed</div><div class="ttdef"><b>Definition</b> stl.h:130</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../#l00032">cwiseAbs()</a>, <a class="el" href="../../#l00150">stl_file::facet_start</a>, <a class="el" href="../../#l00049">stl_facet::normal</a>, <a class="el" href="../../#l00130">stl_stats::normals_fixed</a>, <a class="el" href="../../#l00153">stl_file::stats</a>, <a class="el" href="../../#l00318">stl_calculate_normal()</a>, and <a class="el" href="../../#l00321">stl_normalize_vector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../#l00115">stl_fix_normal_directions()</a>, and <a class="el" href="../../#l00224">stl_fix_normal_values()</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a52040f23a68528dd25ecb65d5459dd98_cgraph.svg" width="346" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="../../closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a52040f23a68528dd25ecb65d5459dd98_icgraph.svg" width="100%" height="486"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a4ec93308f972e070841765c843a07295" name="a4ec93308f972e070841765c843a07295"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ec93308f972e070841765c843a07295">&#9670;&#160;</a></span>reverse_facet()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a> reverse_facet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *&#160;</td>
          <td class="paramname"><em>stl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>facet_num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   35</span>{</div>
<div class="line"><span class="lineno">   36</span>  ++ stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a26d8e017c348225b0022b5af74fa894d">facets_reversed</a>;</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>  <span class="keywordtype">int</span> neighbor[3] = { stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[0], stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[1], stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[2] };</div>
<div class="line"><span class="lineno">   39</span>  <span class="keywordtype">int</span> vnot[3] = { stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[0], stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[1], stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[2] };</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>  <span class="comment">// reverse the facet</span></div>
<div class="line"><span class="lineno">   42</span>  <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_vertex</a> tmp_vertex = stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[facet_num].vertex[0];</div>
<div class="line"><span class="lineno">   43</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[facet_num].vertex[0] = stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[facet_num].vertex[1];</div>
<div class="line"><span class="lineno">   44</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[facet_num].vertex[1] = tmp_vertex;</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>  <span class="comment">// fix the vnots of the neighboring facets</span></div>
<div class="line"><span class="lineno">   47</span>  <span class="keywordflow">if</span> (neighbor[0] != -1)</div>
<div class="line"><span class="lineno">   48</span>    stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[0]].which_vertex_not[(vnot[0] + 1) % 3] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[0]].which_vertex_not[(vnot[0] + 1) % 3] + 3) % 6;</div>
<div class="line"><span class="lineno">   49</span>  <span class="keywordflow">if</span> (neighbor[1] != -1)</div>
<div class="line"><span class="lineno">   50</span>    stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[1]].which_vertex_not[(vnot[1] + 1) % 3] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[1]].which_vertex_not[(vnot[1] + 1) % 3] + 4) % 6;</div>
<div class="line"><span class="lineno">   51</span>  <span class="keywordflow">if</span> (neighbor[2] != -1)</div>
<div class="line"><span class="lineno">   52</span>    stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[2]].which_vertex_not[(vnot[2] + 1) % 3] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[neighbor[2]].which_vertex_not[(vnot[2] + 1) % 3] + 2) % 6;</div>
<div class="line"><span class="lineno">   53</span> </div>
<div class="line"><span class="lineno">   54</span>  <span class="comment">// swap the neighbors of the facet that is being reversed</span></div>
<div class="line"><span class="lineno">   55</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[1] = neighbor[2];</div>
<div class="line"><span class="lineno">   56</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[2] = neighbor[1];</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>  <span class="comment">// swap the vnots of the facet that is being reversed </span></div>
<div class="line"><span class="lineno">   59</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[1] = vnot[2];</div>
<div class="line"><span class="lineno">   60</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[2] = vnot[1];</div>
<div class="line"><span class="lineno">   61</span> </div>
<div class="line"><span class="lineno">   62</span>  <span class="comment">// reverse the values of the vnots of the facet that is being reversed</span></div>
<div class="line"><span class="lineno">   63</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[0] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[0] + 3) % 6;</div>
<div class="line"><span class="lineno">   64</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[1] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[1] + 3) % 6;</div>
<div class="line"><span class="lineno">   65</span>  stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[2] = (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[2] + 3) % 6;</div>
<div class="line"><span class="lineno">   66</span>}</div>
<div class="ttc" id="astructstl__file_html_ae5a66346d3cbcffd764d88c3c9c11c9a"><div class="ttname"><a href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">stl_file::neighbors_start</a></div><div class="ttdeci">std::vector&lt; stl_neighbors &gt; neighbors_start</div><div class="ttdef"><b>Definition</b> stl.h:151</div></div>
<div class="ttc" id="astructstl__stats_html_a26d8e017c348225b0022b5af74fa894d"><div class="ttname"><a href="../../d2/d7f/structstl__stats.html#a26d8e017c348225b0022b5af74fa894d">stl_stats::facets_reversed</a></div><div class="ttdeci">int facets_reversed</div><div class="ttdef"><b>Definition</b> stl.h:126</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../#l00150">stl_file::facet_start</a>, <a class="el" href="../../#l00126">stl_stats::facets_reversed</a>, <a class="el" href="../../#l00151">stl_file::neighbors_start</a>, and <a class="el" href="../../#l00153">stl_file::stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../#l00115">stl_fix_normal_directions()</a>, and <a class="el" href="../../#l00230">stl_reverse_all_facets()</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="../../closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a4ec93308f972e070841765c843a07295_icgraph.svg" width="100%" height="524"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a440ad3441e64d847b1749ec2d469ae68" name="a440ad3441e64d847b1749ec2d469ae68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a440ad3441e64d847b1749ec2d469ae68">&#9670;&#160;</a></span>stl_fix_normal_directions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a> stl_fix_normal_directions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *&#160;</td>
          <td class="paramname"><em>stl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  116</span>{</div>
<div class="line"><span class="lineno">  117</span>  <span class="comment">// This may happen for malformed models, see: https://github.com/prusa3d/PrusaSlicer/issues/2209</span></div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordflow">if</span> (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a> == 0)</div>
<div class="line"><span class="lineno">  119</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>  <span class="keyword">struct </span><a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> {</div>
<div class="line"><span class="lineno">  122</span>      <span class="keywordtype">int</span>         facet_num;</div>
<div class="line"><span class="lineno">  123</span>      <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> *next;</div>
<div class="line"><span class="lineno">  124</span>    };</div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>    <span class="comment">// Initialize linked list.</span></div>
<div class="line"><span class="lineno">  127</span>    boost::object_pool&lt;stl_normal&gt; pool;</div>
<div class="line"><span class="lineno">  128</span>    <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> *<a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a> = pool.construct();</div>
<div class="line"><span class="lineno">  129</span>    <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> *<a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a> = pool.construct();</div>
<div class="line"><span class="lineno">  130</span>  <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a>;</div>
<div class="line"><span class="lineno">  131</span>  <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a>-&gt;next = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a>;</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>  <span class="comment">// Initialize list that keeps track of already fixed facets.</span></div>
<div class="line"><span class="lineno">  134</span>  std::vector&lt;char&gt; norm_sw(stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>, 0);</div>
<div class="line"><span class="lineno">  135</span>  <span class="comment">// Initialize list that keeps track of reversed facets.</span></div>
<div class="line"><span class="lineno">  136</span>    std::vector&lt;int&gt;  reversed_ids;</div>
<div class="line"><span class="lineno">  137</span>    reversed_ids.reserve(stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>);</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordtype">int</span> facet_num = 0;</div>
<div class="line"><span class="lineno">  140</span>    <span class="comment">// If normal vector is not within tolerance and backwards:</span></div>
<div class="line"><span class="lineno">  141</span>    <span class="comment">// Arbitrarily starts at face 0.  If this one is wrong, we&#39;re screwed. Thankfully, the chances</span></div>
<div class="line"><span class="lineno">  142</span>    <span class="comment">// of it being wrong randomly are low if most of the triangles are right:</span></div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a52040f23a68528dd25ecb65d5459dd98">check_normal_vector</a>(stl, 0, 0)) {</div>
<div class="line"><span class="lineno">  144</span>      <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a>(stl, 0);</div>
<div class="line"><span class="lineno">  145</span>        reversed_ids.emplace_back(0);</div>
<div class="line"><span class="lineno">  146</span>    }</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>    <span class="comment">// Say that we&#39;ve fixed this facet:</span></div>
<div class="line"><span class="lineno">  149</span>    norm_sw[facet_num] = 1;</div>
<div class="line"><span class="lineno">  150</span>  <span class="keywordtype">int</span> checked = 1;</div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  153</span>      <span class="comment">// Add neighbors_to_list. Add unconnected neighbors to the list.</span></div>
<div class="line"><span class="lineno">  154</span>      <span class="keywordtype">bool</span> force_exit = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  155</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; ++ j) {</div>
<div class="line"><span class="lineno">  156</span>          <span class="comment">// Reverse the neighboring facets if necessary.</span></div>
<div class="line"><span class="lineno">  157</span>          <span class="keywordflow">if</span> (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].which_vertex_not[j] &gt; 2) {</div>
<div class="line"><span class="lineno">  158</span>            <span class="comment">// If the facet has a neighbor that is -1, it means that edge isn&#39;t shared by another facet</span></div>
<div class="line"><span class="lineno">  159</span>            <span class="keywordflow">if</span> (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j] != -1) {</div>
<div class="line"><span class="lineno">  160</span>                <span class="keywordflow">if</span> (norm_sw[stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j]] == 1) {</div>
<div class="line"><span class="lineno">  161</span>                    <span class="comment">// trying to modify a facet already marked as fixed, revert all changes made until now and exit (fixes: #716, #574, #413, #269, #262, #259, #230, #228, #206)</span></div>
<div class="line"><span class="lineno">  162</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = <span class="keywordtype">int</span>(reversed_ids.size()) - 1; <span class="keywordtype">id</span> &gt;= 0; -- id)</div>
<div class="line"><span class="lineno">  163</span>                        <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a>(stl, reversed_ids[<span class="keywordtype">id</span>]);</div>
<div class="line"><span class="lineno">  164</span>                    force_exit = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  165</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  166</span>                }</div>
<div class="line"><span class="lineno">  167</span>                <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a>(stl, stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j]);</div>
<div class="line"><span class="lineno">  168</span>                reversed_ids.emplace_back(stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j]);</div>
<div class="line"><span class="lineno">  169</span>            }</div>
<div class="line"><span class="lineno">  170</span>          }</div>
<div class="line"><span class="lineno">  171</span>          <span class="comment">// If this edge of the facet is connected:</span></div>
<div class="line"><span class="lineno">  172</span>          <span class="keywordflow">if</span> (stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j] != -1) {</div>
<div class="line"><span class="lineno">  173</span>            <span class="comment">// If we haven&#39;t fixed this facet yet, add it to the list:</span></div>
<div class="line"><span class="lineno">  174</span>            <span class="keywordflow">if</span> (norm_sw[stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j]] != 1) {</div>
<div class="line"><span class="lineno">  175</span>                <span class="comment">// Add node to beginning of list.</span></div>
<div class="line"><span class="lineno">  176</span>                <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> *newn = pool.construct();</div>
<div class="line"><span class="lineno">  177</span>                newn-&gt;facet_num = stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#ae5a66346d3cbcffd764d88c3c9c11c9a">neighbors_start</a>[facet_num].neighbor[j];</div>
<div class="line"><span class="lineno">  178</span>                newn-&gt;next = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next;</div>
<div class="line"><span class="lineno">  179</span>                <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next = newn;</div>
<div class="line"><span class="lineno">  180</span>            }</div>
<div class="line"><span class="lineno">  181</span>          }</div>
<div class="line"><span class="lineno">  182</span>      }</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>      <span class="comment">// an error occourred, quit the for loop and exit</span></div>
<div class="line"><span class="lineno">  185</span>      <span class="keywordflow">if</span> (force_exit)</div>
<div class="line"><span class="lineno">  186</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>      <span class="comment">// Get next facet to fix from top of list.</span></div>
<div class="line"><span class="lineno">  189</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next != <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a>) {</div>
<div class="line"><span class="lineno">  190</span>          facet_num = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next-&gt;facet_num;</div>
<div class="line"><span class="lineno">  191</span>            assert(facet_num &lt; stl-&gt;stats.number_of_facets);</div>
<div class="line"><span class="lineno">  192</span>          <span class="keywordflow">if</span> (norm_sw[facet_num] != 1) { <span class="comment">// If facet is in list mutiple times</span></div>
<div class="line"><span class="lineno">  193</span>            norm_sw[facet_num] = 1; <span class="comment">// Record this one as being fixed.</span></div>
<div class="line"><span class="lineno">  194</span>            ++ checked;</div>
<div class="line"><span class="lineno">  195</span>          }</div>
<div class="line"><span class="lineno">  196</span>          <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> *temp = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next;  <span class="comment">// Delete this facet from the list.</span></div>
<div class="line"><span class="lineno">  197</span>          <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next = <a class="code hl_function" href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a>-&gt;next-&gt;next;</div>
<div class="line"><span class="lineno">  198</span>          <span class="comment">// pool.destroy(temp);</span></div>
<div class="line"><span class="lineno">  199</span>      } <span class="keywordflow">else</span> { <span class="comment">// If we ran out of facets to fix: All of the facets in this part have been fixed.</span></div>
<div class="line"><span class="lineno">  200</span>          ++ stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#aa1a3f92d93984a71a6911eebcd014272">number_of_parts</a>;</div>
<div class="line"><span class="lineno">  201</span>          <span class="keywordflow">if</span> (checked &gt;= <span class="keywordtype">int</span>(stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>))</div>
<div class="line"><span class="lineno">  202</span>            <span class="comment">// All of the facets have been checked.  Bail out.</span></div>
<div class="line"><span class="lineno">  203</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  204</span>        <span class="comment">// There is another part here.  Find it and continue.</span></div>
<div class="line"><span class="lineno">  205</span>        <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../da/d6f/unistd_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> i = 0; i &lt; stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>; ++ i)</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">if</span> (norm_sw[i] == 0) {</div>
<div class="line"><span class="lineno">  207</span>              <span class="comment">// This is the first facet of the next part.</span></div>
<div class="line"><span class="lineno">  208</span>              facet_num = i;</div>
<div class="line"><span class="lineno">  209</span>              <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a52040f23a68528dd25ecb65d5459dd98">check_normal_vector</a>(stl, i, 0)) {</div>
<div class="line"><span class="lineno">  210</span>                  <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a>(stl, i);</div>
<div class="line"><span class="lineno">  211</span>                  reversed_ids.emplace_back(i);</div>
<div class="line"><span class="lineno">  212</span>              }</div>
<div class="line"><span class="lineno">  213</span>              norm_sw[facet_num] = 1;</div>
<div class="line"><span class="lineno">  214</span>              ++ checked;</div>
<div class="line"><span class="lineno">  215</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  216</span>            }</div>
<div class="line"><span class="lineno">  217</span>      }</div>
<div class="line"><span class="lineno">  218</span>    }</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>  <span class="comment">// pool.destroy(head);</span></div>
<div class="line"><span class="lineno">  221</span>  <span class="comment">// pool.destroy(tail);</span></div>
<div class="line"><span class="lineno">  222</span>}</div>
<div class="ttc" id="a_block_methods_8h_html_a4c0b2c42fe7ffe307dc6bc88f24f001d"><div class="ttname"><a href="../../d6/d4f/_block_methods_8h.html#a4c0b2c42fe7ffe307dc6bc88f24f001d">tail</a></div><div class="ttdeci">EIGEN_DEVICE_FUNC SegmentReturnType tail(Index n)</div><div class="ttdoc">This is the const version of tail(Index).</div><div class="ttdef"><b>Definition</b> BlockMethods.h:949</div></div>
<div class="ttc" id="a_block_methods_8h_html_a66cee6936cfa159827535f010684d973"><div class="ttname"><a href="../../d6/d4f/_block_methods_8h.html#a66cee6936cfa159827535f010684d973">head</a></div><div class="ttdeci">EIGEN_DEVICE_FUNC SegmentReturnType head(Index n)</div><div class="ttdoc">This is the const version of head(Index).</div><div class="ttdef"><b>Definition</b> BlockMethods.h:919</div></div>
<div class="ttc" id="anormals_8cpp_html_a4ec93308f972e070841765c843a07295"><div class="ttname"><a href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a></div><div class="ttdeci">static void reverse_facet(stl_file *stl, int facet_num)</div><div class="ttdef"><b>Definition</b> normals.cpp:34</div></div>
<div class="ttc" id="anormals_8cpp_html_a52040f23a68528dd25ecb65d5459dd98"><div class="ttname"><a href="../../d0/d2d/normals_8cpp.html#a52040f23a68528dd25ecb65d5459dd98">check_normal_vector</a></div><div class="ttdeci">static bool check_normal_vector(stl_file *stl, int facet_num, int normal_fix_flag)</div><div class="ttdef"><b>Definition</b> normals.cpp:69</div></div>
<div class="ttc" id="astructstl__stats_html_a1d1058a815e6c44ce9b03a2afe82cf27"><div class="ttname"><a href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">stl_stats::number_of_facets</a></div><div class="ttdeci">uint32_t number_of_facets</div><div class="ttdef"><b>Definition</b> stl.h:95</div></div>
<div class="ttc" id="astructstl__stats_html_aa1a3f92d93984a71a6911eebcd014272"><div class="ttname"><a href="../../d2/d7f/structstl__stats.html#aa1a3f92d93984a71a6911eebcd014272">stl_stats::number_of_parts</a></div><div class="ttdeci">int number_of_parts</div><div class="ttdef"><b>Definition</b> stl.h:132</div></div>
<div class="ttc" id="aunistd_8h_html_a6eb1e68cc391dd753bc8ce896dbb8315"><div class="ttname"><a href="../../da/d6f/unistd_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a></div><div class="ttdeci">unsigned __int32 uint32_t</div><div class="ttdef"><b>Definition</b> unistd.h:79</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../#l00069">check_normal_vector()</a>, <a class="el" href="../../#l00919">head()</a>, <a class="el" href="../../#l00151">stl_file::neighbors_start</a>, <a class="el" href="../../#l00095">stl_stats::number_of_facets</a>, <a class="el" href="../../#l00132">stl_stats::number_of_parts</a>, <a class="el" href="../../#l00034">reverse_facet()</a>, <a class="el" href="../../#l00153">stl_file::stats</a>, and <a class="el" href="../../#l00949">tail()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../#l00299">stl_repair()</a>, and <a class="el" href="../../#l00080">Slic3r::trianglemesh_repair_on_import()</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a440ad3441e64d847b1749ec2d469ae68_cgraph.svg" width="559" height="234"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="../../closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a440ad3441e64d847b1749ec2d469ae68_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a23672d4232108aea47cb3559d3d26620" name="a23672d4232108aea47cb3559d3d26620"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23672d4232108aea47cb3559d3d26620">&#9670;&#160;</a></span>stl_fix_normal_values()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a> stl_fix_normal_values </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *&#160;</td>
          <td class="paramname"><em>stl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  225</span>{</div>
<div class="line"><span class="lineno">  226</span>  <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../da/d6f/unistd_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> i = 0; i &lt; stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>; ++ i)</div>
<div class="line"><span class="lineno">  227</span>      <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a52040f23a68528dd25ecb65d5459dd98">check_normal_vector</a>(stl, i, 1);</div>
<div class="line"><span class="lineno">  228</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../#l00069">check_normal_vector()</a>, <a class="el" href="../../#l00095">stl_stats::number_of_facets</a>, and <a class="el" href="../../#l00153">stl_file::stats</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../#l00299">stl_repair()</a>, and <a class="el" href="../../#l00080">Slic3r::trianglemesh_repair_on_import()</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a23672d4232108aea47cb3559d3d26620_cgraph.svg" width="542" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="../../closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a23672d4232108aea47cb3559d3d26620_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a2aede818a0eba00cc97d4401a2e69eb9" name="a2aede818a0eba00cc97d4401a2e69eb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aede818a0eba00cc97d4401a2e69eb9">&#9670;&#160;</a></span>stl_reverse_all_facets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d95/glu-libtess_8h.html#a4292190e3f1f6b373a760c7d9316ad3c">void</a> stl_reverse_all_facets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/df0/structstl__file.html">stl_file</a> *&#160;</td>
          <td class="paramname"><em>stl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  231</span>{</div>
<div class="line"><span class="lineno">  232</span>  <a class="code hl_class" href="../../d2/d2d/class_eigen_1_1_matrix.html">stl_normal</a> <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">  233</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../da/d6f/unistd_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> i = 0; i &lt; stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a2488861d11a4e223d2208c5eb0fd1341">stats</a>.<a class="code hl_variable" href="../../d2/d7f/structstl__stats.html#a1d1058a815e6c44ce9b03a2afe82cf27">number_of_facets</a>; ++ i) {</div>
<div class="line"><span class="lineno">  234</span>      <a class="code hl_function" href="../../d0/d2d/normals_8cpp.html#a4ec93308f972e070841765c843a07295">reverse_facet</a>(stl, i);</div>
<div class="line"><span class="lineno">  235</span>      <a class="code hl_function" href="../../d5/d51/stl_8h.html#a54a7a9b89aeb6bd37c758e2e84d2e19c">stl_calculate_normal</a>(normal, &amp;stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[i]);</div>
<div class="line"><span class="lineno">  236</span>      <a class="code hl_function" href="../../d5/d51/stl_8h.html#afd576ac265350e491aac90c15f7ebcf5">stl_normalize_vector</a>(normal);</div>
<div class="line"><span class="lineno">  237</span>      stl-&gt;<a class="code hl_variable" href="../../dd/df0/structstl__file.html#a12be2d9b48bb536d8692fae451f59125">facet_start</a>[i].normal = <a class="code hl_function" href="../../dd/d3d/namespace_slic3r_1_1sla_1_1anonymous__namespace_02_rotfinder_8cpp_03.html#a9702d7dc6b0a37966d1157909ff81294">normal</a>;</div>
<div class="line"><span class="lineno">  238</span>    }</div>
<div class="line"><span class="lineno">  239</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../#l00150">stl_file::facet_start</a>, <a class="el" href="../../#l00095">stl_stats::number_of_facets</a>, <a class="el" href="../../#l00034">reverse_facet()</a>, <a class="el" href="../../#l00153">stl_file::stats</a>, <a class="el" href="../../#l00318">stl_calculate_normal()</a>, and <a class="el" href="../../#l00321">stl_normalize_vector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../#l00290">stl_calculate_volume()</a>, <a class="el" href="../../#l00206">stl_mirror_xy()</a>, <a class="el" href="../../#l00234">stl_mirror_xz()</a>, <a class="el" href="../../#l00220">stl_mirror_yz()</a>, and <a class="el" href="../../#l00299">stl_repair()</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="../../closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a2aede818a0eba00cc97d4401a2e69eb9_cgraph.svg" width="348" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="../../closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d0/d2d/normals_8cpp_a2aede818a0eba00cc97d4401a2e69eb9_icgraph.svg" width="100%" height="515"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_e813e21d05d26e384a417b3733f81704.html">admesh</a></li><li class="navelem"><a class="el" href="../../d0/d2d/normals_8cpp.html">normals.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
